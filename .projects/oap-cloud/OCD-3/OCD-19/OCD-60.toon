id: OCD-60
type: task
parent: OCD-19
title: Build Support page with FAQ accordion and contact form
status: backlog
created: 2026-02-09
assignee: null
estimate_minutes: 30
estimate_tokens: null
description: "Create the Support page with an admin-manageable FAQ accordion and a contact form.\n\n**Steps:**\n\n1. Create FAQ model and migration: `cd src/platform && php artisan make:model Faq -mf`\nEdit `src/platform/database/migrations/*_create_faqs_table.php`:\n```php\nSchema::create('faqs', function (Blueprint $table) {\n    $table->id();\n    $table->string('question');\n    $table->text('answer');\n    $table->integer('sort_order')->default(0);\n    $table->boolean('is_published')->default(true);\n    $table->timestamps();\n});\n```\n\nEdit `src/platform/app/Models/Faq.php`:\n```php\n<?php\nnamespace App\\Models;\n\nuse Illuminate\\Database\\Eloquent\\Model;\nuse Illuminate\\Database\\Eloquent\\Factories\\HasFactory;\n\nclass Faq extends Model\n{\n    use HasFactory;\n    protected $fillable = ['question', 'answer', 'sort_order', 'is_published'];\n    protected $casts = ['is_published' => 'boolean'];\n\n    public function scopePublished($query) { return $query->where('is_published', true); }\n    public function scopeOrdered($query) { return $query->orderBy('sort_order'); }\n}\n```\n\n2. Create contact form notification: `php artisan make:notification ContactFormSubmitted`\nEdit `src/platform/app/Notifications/ContactFormSubmitted.php`:\n```php\n<?php\nnamespace App\\Notifications;\n\nuse Illuminate\\Bus\\Queueable;\nuse Illuminate\\Notifications\\Messages\\MailMessage;\nuse Illuminate\\Notifications\\Notification;\n\nclass ContactFormSubmitted extends Notification\n{\n    use Queueable;\n\n    public function __construct(\n        private string $name,\n        private string $email,\n        private string $subject,\n        private string $message\n    ) {}\n\n    public function via($notifiable): array { return ['mail', 'database']; }\n\n    public function toMail($notifiable): MailMessage\n    {\n        return (new MailMessage)\n            ->subject(\"Contact Form: {$this->subject}\")\n            ->line(\"From: {$this->name} ({$this->email})\")\n            ->line($this->message)\n            ->action('Reply', \"mailto:{$this->email}\");\n    }\n\n    public function toArray($notifiable): array\n    {\n        return [\n            'type' => 'contact_form',\n            'name' => $this->name,\n            'email' => $this->email,\n            'subject' => $this->subject,\n            'message' => $this->message,\n        ];\n    }\n}\n```\n\n3. Create controller: `php artisan make:controller SupportController`\nEdit `src/platform/app/Http/Controllers/SupportController.php`:\n```php\n<?php\nnamespace App\\Http\\Controllers;\n\nuse App\\Models\\Faq;\nuse App\\Models\\User;\nuse App\\Notifications\\ContactFormSubmitted;\nuse Illuminate\\Http\\Request;\nuse Inertia\\Inertia;\n\nclass SupportController extends Controller\n{\n    public function show()\n    {\n        return Inertia::render('Support', [\n            'faqs' => Faq::published()->ordered()->get(['id', 'question', 'answer']),\n        ]);\n    }\n\n    public function contact(Request $request)\n    {\n        $validated = $request->validate([\n            'name' => 'required|string|max:255',\n            'email' => 'required|email|max:255',\n            'subject' => 'required|string|max:255',\n            'message' => 'required|string|max:5000',\n        ]);\n\n        // Notify all admins\n        User::where('is_admin', true)->each(function ($admin) use ($validated) {\n            $admin->notify(new ContactFormSubmitted(\n                $validated['name'], $validated['email'], $validated['subject'], $validated['message']\n            ));\n        });\n\n        return back()->with('status', 'Your message has been sent. We will get back to you soon.');\n    }\n}\n```\n\n4. Create `src/platform/resources/js/Pages/Support.tsx`:\n```tsx\nimport { FormEvent, useState } from 'react';\nimport { useForm } from '@inertiajs/react';\nimport GuestLayout from '@/Layouts/GuestLayout';\n\ninterface FaqItem { id: number; question: string; answer: string; }\ninterface Props { faqs: FaqItem[]; status?: string; }\n\nfunction FaqAccordion({ faqs }: { faqs: FaqItem[] }) {\n    const [openId, setOpenId] = useState<number | null>(null);\n    return (\n        <div className=\"divide-y divide-gray-200 rounded-xl border border-gray-200\">\n            {faqs.map(faq => (\n                <div key={faq.id}>\n                    <button onClick={() => setOpenId(openId === faq.id ? null : faq.id)}\n                        className=\"flex w-full items-center justify-between px-6 py-4 text-left text-gray-900 hover:bg-gray-50\">\n                        <span className=\"font-medium\">{faq.question}</span>\n                        <span className=\"ml-4 text-gray-400\">{openId === faq.id ? 'âˆ’' : '+'}</span>\n                    </button>\n                    {openId === faq.id && (\n                        <div className=\"px-6 pb-4 text-gray-600\">{faq.answer}</div>\n                    )}\n                </div>\n            ))}\n        </div>\n    );\n}\n\nexport default function Support({ faqs }: Props) {\n    const { data, setData, post, processing, errors } = useForm({\n        name: '', email: '', subject: '', message: '',\n    });\n    const [status, setStatus] = useState<string | null>(null);\n\n    const submit = (e: FormEvent) => {\n        e.preventDefault();\n        post('/support/contact', {\n            onSuccess: () => { setStatus('Message sent!'); },\n        });\n    };\n\n    return (\n        <GuestLayout title=\"Support\">\n            <div className=\"py-24\">\n                <div className=\"mx-auto max-w-4xl px-4\">\n                    <h1 className=\"text-4xl font-bold text-gray-900 text-center\">Support</h1>\n\n                    {/* FAQ Section */}\n                    <section className=\"mt-16\">\n                        <h2 className=\"text-2xl font-bold text-gray-900 mb-6\">Frequently Asked Questions</h2>\n                        {faqs.length > 0 ? <FaqAccordion faqs={faqs} /> : (\n                            <p className=\"text-gray-500\">No FAQs available yet.</p>\n                        )}\n                    </section>\n\n                    {/* Contact Form */}\n                    <section className=\"mt-16\">\n                        <h2 className=\"text-2xl font-bold text-gray-900 mb-6\">Contact Us</h2>\n                        {status && <div className=\"mb-4 rounded-md bg-green-50 p-3 text-sm text-green-700\">{status}</div>}\n                        <form onSubmit={submit} className=\"space-y-4 max-w-lg\">\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700\">Name</label>\n                                <input type=\"text\" value={data.name} onChange={e => setData('name', e.target.value)}\n                                    className=\"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2\" required />\n                                {errors.name && <p className=\"mt-1 text-sm text-red-600\">{errors.name}</p>}\n                            </div>\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700\">Email</label>\n                                <input type=\"email\" value={data.email} onChange={e => setData('email', e.target.value)}\n                                    className=\"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2\" required />\n                                {errors.email && <p className=\"mt-1 text-sm text-red-600\">{errors.email}</p>}\n                            </div>\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700\">Subject</label>\n                                <input type=\"text\" value={data.subject} onChange={e => setData('subject', e.target.value)}\n                                    className=\"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2\" required />\n                            </div>\n                            <div>\n                                <label className=\"block text-sm font-medium text-gray-700\">Message</label>\n                                <textarea value={data.message} onChange={e => setData('message', e.target.value)}\n                                    rows={5} className=\"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2\" required />\n                            </div>\n                            <button type=\"submit\" disabled={processing}\n                                className=\"rounded-md bg-indigo-600 px-6 py-2 text-white hover:bg-indigo-700\">\n                                {processing ? 'Sending...' : 'Send Message'}\n                            </button>\n                        </form>\n                    </section>\n\n                    {/* Community Links */}\n                    <section className=\"mt-16 text-center\">\n                        <h2 className=\"text-2xl font-bold text-gray-900 mb-6\">Community</h2>\n                        <div className=\"flex justify-center gap-6\">\n                            <a href=\"#\" className=\"rounded-lg border border-gray-200 px-6 py-3 hover:shadow-md\">Discord</a>\n                            <a href=\"#\" className=\"rounded-lg border border-gray-200 px-6 py-3 hover:shadow-md\">GitHub</a>\n                        </div>\n                    </section>\n                </div>\n            </div>\n        </GuestLayout>\n    );\n}\n```\n\n5. Add routes in `src/platform/routes/web.php`:\n```php\nRoute::get('/support', [SupportController::class, 'show'])->name('support');\nRoute::post('/support/contact', [SupportController::class, 'contact'])->name('support.contact');\n```\n\n6. Run `php artisan migrate`\n\n7. Create seeder: `php artisan make:seeder FaqSeeder`\nEdit `src/platform/database/seeders/FaqSeeder.php` with sample FAQ entries.\n\n**File paths:**\n- `src/platform/database/migrations/*_create_faqs_table.php`\n- `src/platform/app/Models/Faq.php`\n- `src/platform/app/Notifications/ContactFormSubmitted.php`\n- `src/platform/app/Http/Controllers/SupportController.php`\n- `src/platform/resources/js/Pages/Support.tsx`\n- `src/platform/routes/web.php` (updated)\n- `src/platform/database/seeders/FaqSeeder.php`"
acceptance_criteria[11]: Support page renders at /support,FAQ accordion with expand/collapse functionality,FAQs loaded from database (published and ordered),"Contact form with name, email, subject, message fields",Form validation with error display,Contact form sends email notification to all admins,Contact form creates database notification for admins,Success message shown after submission,Community links section with Discord and GitHub,Faq model with published/ordered scopes,FaqSeeder created with sample data
story: OCD-19
epic: OCD-3
project: oap-cloud
projectKey: OCD
projectKey: OCD
path: .projects/oap-cloud/OCD-3/OCD-19/OCD-60.toon
