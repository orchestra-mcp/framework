id: OMB-22
type: task
parent: OMB-18
title: Build LoginScreen with form validation and API integration
status: done
created: 2026-02-09
assignee: Claude
estimate_minutes: 40
estimate_tokens: null
actual_minutes: 15
actual_tokens: 3500
completed: 2026-02-10
blockers: []
description: "Create the Login screen with full form validation, API integration, and error handling.\n\n1. Create `src/mobile/src/app/auth/LoginScreen.tsx`:\n   ```typescript\n   import React, { useState } from 'react';\n   import {\n     View, Text, TextInput, TouchableOpacity, ActivityIndicator, Alert,\n     KeyboardAvoidingView, Platform, ScrollView,\n   } from 'react-native';\n   import type { AuthScreenProps } from '@navigation/types';\n   import { authService } from '@services/authService';\n   import { useAuthStore } from '@stores';\n   import { secureStorage } from '@services/secureStorage';\n\n   export const LoginScreen: React.FC<AuthScreenProps<'Login'>> = ({ navigation }) => {\n     const [email, setEmail] = useState('');\n     const [password, setPassword] = useState('');\n     const [errors, setErrors] = useState<{ email?: string; password?: string }>({});\n     const [isLoading, setIsLoading] = useState(false);\n     const { setUser, setToken } = useAuthStore();\n\n     const validate = (): boolean => {\n       const newErrors: typeof errors = {};\n       if (!email) newErrors.email = 'Email is required';\n       else if (!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(email)) newErrors.email = 'Invalid email format';\n       if (!password) newErrors.password = 'Password is required';\n       else if (password.length < 8) newErrors.password = 'Password must be at least 8 characters';\n       setErrors(newErrors);\n       return Object.keys(newErrors).length === 0;\n     };\n\n     const handleLogin = async () => {\n       if (!validate()) return;\n       setIsLoading(true);\n       try {\n         const deviceName = `${Platform.OS}-${Platform.Version}`;\n         const response = await authService.login({ email, password, device_name: deviceName });\n         if (response.requires_2fa) {\n           navigation.navigate('OTPVerification', { email, type: 'login' });\n           return;\n         }\n         await secureStorage.setToken(response.token);\n         setToken(response.token);\n         setUser(response.user);\n       } catch (error: any) {\n         const message = error.response?.data?.message ?? 'Login failed. Please try again.';\n         Alert.alert('Login Error', message);\n       } finally {\n         setIsLoading(false);\n       }\n     };\n\n     return (\n       <KeyboardAvoidingView\n         behavior={Platform.OS === 'ios' ? 'padding' : 'height'}\n         className=\"flex-1\"\n       >\n         <ScrollView\n           contentContainerClassName=\"flex-1 justify-center px-6\"\n           keyboardShouldPersistTaps=\"handled\"\n         >\n           {/* Orchestra Logo / Title */}\n           <View className=\"items-center mb-10\">\n             <Text className=\"text-3xl font-bold text-gray-900\">Orchestra</Text>\n             <Text className=\"text-base text-gray-500 mt-1\">Sign in to your account</Text>\n           </View>\n\n           {/* Email Input */}\n           <View className=\"mb-4\">\n             <Text className=\"text-sm font-medium text-gray-700 mb-1\">Email</Text>\n             <TextInput\n               className=\"border border-gray-300 rounded-lg px-4 py-3 text-base text-gray-900 bg-white\"\n               placeholder=\"you@example.com\"\n               placeholderTextColor=\"#9ca3af\"\n               value={email}\n               onChangeText={(text) => { setEmail(text); setErrors((e) => ({ ...e, email: undefined })); }}\n               keyboardType=\"email-address\"\n               autoCapitalize=\"none\"\n               autoComplete=\"email\"\n               editable={!isLoading}\n             />\n             {errors.email && <Text className=\"text-red-500 text-xs mt-1\">{errors.email}</Text>}\n           </View>\n\n           {/* Password Input */}\n           <View className=\"mb-6\">\n             <Text className=\"text-sm font-medium text-gray-700 mb-1\">Password</Text>\n             <TextInput\n               className=\"border border-gray-300 rounded-lg px-4 py-3 text-base text-gray-900 bg-white\"\n               placeholder=\"Enter your password\"\n               placeholderTextColor=\"#9ca3af\"\n               value={password}\n               onChangeText={(text) => { setPassword(text); setErrors((e) => ({ ...e, password: undefined })); }}\n               secureTextEntry\n               autoComplete=\"password\"\n               editable={!isLoading}\n             />\n             {errors.password && <Text className=\"text-red-500 text-xs mt-1\">{errors.password}</Text>}\n           </View>\n\n           {/* Forgot Password Link */}\n           <TouchableOpacity\n             onPress={() => navigation.navigate('ResetPassword')}\n             className=\"mb-6\"\n             disabled={isLoading}\n           >\n             <Text className=\"text-primary-600 text-sm text-right\">Forgot password?</Text>\n           </TouchableOpacity>\n\n           {/* Login Button */}\n           <TouchableOpacity\n             onPress={handleLogin}\n             disabled={isLoading}\n             className=\"bg-primary-600 rounded-lg py-3.5 items-center mb-4\"\n             activeOpacity={0.8}\n           >\n             {isLoading ? (\n               <ActivityIndicator color=\"#ffffff\" />\n             ) : (\n               <Text className=\"text-white font-semibold text-base\">Sign In</Text>\n             )}\n           </TouchableOpacity>\n\n           {/* Register Link */}\n           <View className=\"flex-row justify-center\">\n             <Text className=\"text-gray-500\">Don't have an account? </Text>\n             <TouchableOpacity onPress={() => navigation.navigate('Register')} disabled={isLoading}>\n               <Text className=\"text-primary-600 font-semibold\">Sign Up</Text>\n             </TouchableOpacity>\n           </View>\n         </ScrollView>\n       </KeyboardAvoidingView>\n     );\n   };\n   ```\n\n2. The screen MUST:\n   - Use NativeWind className for all styling (no StyleSheet.create)\n   - Handle keyboard avoidance properly on both iOS and Android\n   - Show inline validation errors below each field\n   - Show ActivityIndicator in the button during API calls\n   - Disable all inputs and buttons during loading\n   - Navigate to OTPVerification if API returns requires_2fa: true\n   - Store token securely and update auth store on success\n\n3. Verify: Screen renders, form validation works, tapping Sign In with empty fields shows errors."
acceptance_criteria[12]: LoginScreen.tsx exists at src/mobile/src/app/auth/LoginScreen.tsx,Email field validates format and shows error for invalid input,Password field validates minimum 8 characters,"Submit calls authService.login with email, password, and device_name",Loading spinner replaces button text during API call,All inputs disabled during loading state,Successful login stores token via secureStorage and updates authStore,"If response.requires_2fa is true, navigates to OTPVerification screen",API errors shown via Alert.alert with server message,Forgot Password link navigates to ResetPassword screen,Sign Up link navigates to Register screen,All styling uses NativeWind className (no StyleSheet.create)

**⚠️ Design System Dependency:**
This task requires the Orchestra Design System foundation to be completed first (ODS-1, ODS-2). Use design tokens and core components from `packages/design-system/` instead of creating custom styles.
story: OMB-18
epic: OMB-2
project: oap-mobile
projectKey: OMB
path: .projects/oap-mobile/OMB-2/OMB-18/OMB-22.toon
