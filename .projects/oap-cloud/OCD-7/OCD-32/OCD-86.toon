id: OCD-86
type: task
parent: OCD-32
title: Build Feature Flags system
status: backlog
created: 2026-02-09
assignee: null
estimate_minutes: 25
estimate_tokens: null
blockers: ["OCD-85"]
description: "Create a feature flags system for controlling IDE features system-wide and per-plan.\n\n**Steps:**\n\n1. `cd src/platform && php artisan make:model FeatureFlag -m`\n\nEdit `src/platform/database/migrations/*_create_feature_flags_table.php`:\n```php\nSchema::create('feature_flags', function (Blueprint $table) {\n    $table->id();\n    $table->string('key')->unique(); // e.g., 'ai_agent', 'marketplace', 'pomodoro'\n    $table->string('name');\n    $table->text('description')->nullable();\n    $table->boolean('enabled')->default(true);\n    $table->boolean('pro_only')->default(false); // only available on paid plan\n    $table->timestamps();\n});\n```\n\nEdit `src/platform/app/Models/FeatureFlag.php`:\n```php\n<?php\nnamespace App\\Models;\n\nuse Illuminate\\Database\\Eloquent\\Model;\n\nclass FeatureFlag extends Model\n{\n    protected $fillable = ['key', 'name', 'description', 'enabled', 'pro_only'];\n    protected $casts = ['enabled' => 'boolean', 'pro_only' => 'boolean'];\n\n    public static function isEnabled(string $key): bool\n    {\n        $flag = self::where('key', $key)->first();\n        return $flag?->enabled ?? false;\n    }\n\n    public static function isEnabledForUser(string $key, User $user): bool\n    {\n        $flag = self::where('key', $key)->first();\n        if (!$flag || !$flag->enabled) return false;\n        if ($flag->pro_only) {\n            // Check if user has pro plan (placeholder logic)\n            return $user->is_admin || ($user->subscription_plan ?? 'free') !== 'free';\n        }\n        return true;\n    }\n}\n```\n\n2. Create controller: `php artisan make:controller Admin/FeatureFlagController`\n```php\n<?php\nnamespace App\\Http\\Controllers\\Admin;\n\nuse App\\Http\\Controllers\\Controller;\nuse App\\Models\\FeatureFlag;\nuse Illuminate\\Http\\Request;\nuse Inertia\\Inertia;\n\nclass FeatureFlagController extends Controller\n{\n    public function index(Request $request)\n    {\n        return Inertia::render('Admin/Features', [\n            'features' => FeatureFlag::orderBy('name')->get(),\n        ]);\n    }\n\n    public function toggle(Request $request, int $id)\n    {\n        $flag = FeatureFlag::findOrFail($id);\n        $flag->update(['enabled' => !$flag->enabled]);\n        return back();\n    }\n\n    public function update(Request $request, int $id)\n    {\n        $request->validate([\n            'name' => 'required|string|max:255',\n            'description' => 'nullable|string',\n            'enabled' => 'boolean',\n            'pro_only' => 'boolean',\n        ]);\n        FeatureFlag::findOrFail($id)->update($request->only('name', 'description', 'enabled', 'pro_only'));\n        return back()->with('status', 'Feature flag updated.');\n    }\n\n    public function store(Request $request)\n    {\n        $request->validate([\n            'key' => 'required|string|unique:feature_flags',\n            'name' => 'required|string|max:255',\n        ]);\n        FeatureFlag::create($request->only('key', 'name', 'description', 'enabled', 'pro_only'));\n        return back()->with('status', 'Feature flag created.');\n    }\n}\n```\n\n3. Create `src/platform/resources/js/Pages/Admin/Features.tsx`:\n- Feature flag list with toggle switches\n- Each row: name, key, description, enabled toggle, pro_only toggle\n- Add new feature flag form\n- Search/filter\n\n4. Create seeder with default feature flags:\n```php\n// database/seeders/FeatureFlagSeeder.php\nFeatureFlag::create(['key' => 'ai_agent', 'name' => 'AI Agent', 'description' => 'Claude Code AI agent integration']);\nFeatureFlag::create(['key' => 'marketplace', 'name' => 'Extension Marketplace']);\nFeatureFlag::create(['key' => 'pomodoro', 'name' => 'Pomodoro Timer']);\nFeatureFlag::create(['key' => 'sprint_tracking', 'name' => 'Sprint Tracking', 'pro_only' => true]);\nFeatureFlag::create(['key' => 'team_dashboard', 'name' => 'Team Dashboard', 'pro_only' => true]);\n```\n\n5. Add routes:\n```php\nRoute::get('/admin/features', [FeatureFlagController::class, 'index'])->name('admin.features');\nRoute::post('/admin/features', [FeatureFlagController::class, 'store'])->name('admin.features.store');\nRoute::patch('/admin/features/{id}/toggle', [FeatureFlagController::class, 'toggle'])->name('admin.features.toggle');\nRoute::put('/admin/features/{id}', [FeatureFlagController::class, 'update'])->name('admin.features.update');\n```\n\n**File paths:**\n- `src/platform/database/migrations/*_create_feature_flags_table.php`\n- `src/platform/app/Models/FeatureFlag.php`\n- `src/platform/app/Http/Controllers/Admin/FeatureFlagController.php`\n- `src/platform/resources/js/Pages/Admin/Features.tsx`\n- `src/platform/database/seeders/FeatureFlagSeeder.php`\n- `src/platform/routes/web.php` (updated)"
acceptance_criteria[9]: "feature_flags table with key, name, description, enabled, pro_only",FeatureFlag model with isEnabled() and isEnabledForUser() static methods,Pro-only gating checks user plan,Admin features page at /admin/features,Toggle switch per feature to enable/disable,Pro-only toggle per feature,"Add new feature flag form with key, name, description",Default feature flags seeded,Feature flag list with search

**Dependencies:**
This task requires the following tasks to be completed first: OCD-85
story: OCD-32
epic: OCD-7
project: oap-cloud
projectKey: OCD
path: .projects/oap-cloud/OCD-7/OCD-32/OCD-86.toon
