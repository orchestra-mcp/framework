id: OCD-72
type: task
parent: OCD-25
title: Build synced tasks page with project/epic/story/task hierarchy
status: backlog
created: 2026-02-09
assignee: null
estimate_minutes: 35
estimate_tokens: null
description: "Create the tasks page with hierarchical tree view and filtering.\n\n**Steps:**\n\n1. Create controller: `cd src/platform && php artisan make:controller Dashboard/TasksController`\nEdit `src/platform/app/Http/Controllers/Dashboard/TasksController.php`:\n```php\n<?php\nnamespace App\\Http\\Controllers\\Dashboard;\n\nuse App\\Http\\Controllers\\Controller;\nuse App\\Models\\TaskEntry;\nuse Illuminate\\Http\\Request;\nuse Inertia\\Inertia;\n\nclass TasksController extends Controller\n{\n    public function index(Request $request)\n    {\n        $user = $request->user();\n        $query = TaskEntry::forUser($user->id);\n\n        if ($request->filled('status')) {\n            $query->where('status', $request->status);\n        }\n        if ($request->filled('priority')) {\n            $query->where('priority', $request->priority);\n        }\n        if ($request->filled('search')) {\n            $search = $request->search;\n            $query->where(fn ($q) => $q->where('task_title', 'like', \"%{$search}%\")\n                ->orWhere('project_name', 'like', \"%{$search}%\")\n                ->orWhere('task_key', 'like', \"%{$search}%\"));\n        }\n        if ($request->filled('project')) {\n            $query->where('project_name', $request->project);\n        }\n\n        $sortField = $request->sort ?? 'updated_at';\n        $sortDir = $request->dir ?? 'desc';\n        $query->orderBy($sortField, $sortDir);\n\n        // Build hierarchical structure\n        $tasks = $query->get();\n        $hierarchy = $this->buildHierarchy($tasks);\n\n        return Inertia::render('Dashboard/Tasks', [\n            'hierarchy' => $hierarchy,\n            'filters' => $request->only(['status', 'priority', 'search', 'project', 'sort', 'dir']),\n            'projects' => TaskEntry::forUser($user->id)->distinct()->pluck('project_name'),\n            'statusCounts' => [\n                'all' => TaskEntry::forUser($user->id)->count(),\n                'backlog' => TaskEntry::forUser($user->id)->where('status', 'backlog')->count(),\n                'in_progress' => TaskEntry::forUser($user->id)->where('status', 'in_progress')->count(),\n                'review' => TaskEntry::forUser($user->id)->where('status', 'review')->count(),\n                'done' => TaskEntry::forUser($user->id)->where('status', 'done')->count(),\n            ],\n        ]);\n    }\n\n    private function buildHierarchy($tasks): array\n    {\n        $tree = [];\n        foreach ($tasks as $task) {\n            $projectKey = $task->project_name;\n            $epicKey = $task->epic_name ?? 'No Epic';\n            $storyKey = $task->story_name ?? 'No Story';\n\n            if (!isset($tree[$projectKey])) {\n                $tree[$projectKey] = ['name' => $projectKey, 'epics' => []];\n            }\n            if (!isset($tree[$projectKey]['epics'][$epicKey])) {\n                $tree[$projectKey]['epics'][$epicKey] = ['name' => $epicKey, 'stories' => []];\n            }\n            if (!isset($tree[$projectKey]['epics'][$epicKey]['stories'][$storyKey])) {\n                $tree[$projectKey]['epics'][$epicKey]['stories'][$storyKey] = ['name' => $storyKey, 'tasks' => []];\n            }\n            $tree[$projectKey]['epics'][$epicKey]['stories'][$storyKey]['tasks'][] = [\n                'id' => $task->id,\n                'title' => $task->task_title,\n                'key' => $task->task_key,\n                'status' => $task->status,\n                'priority' => $task->priority,\n                'description' => $task->description,\n                'updated_at' => $task->updated_at->diffForHumans(),\n            ];\n        }\n\n        // Convert associative arrays to indexed for React\n        return collect($tree)->map(fn ($project) => [\n            'name' => $project['name'],\n            'epics' => collect($project['epics'])->map(fn ($epic) => [\n                'name' => $epic['name'],\n                'stories' => collect($epic['stories'])->map(fn ($story) => [\n                    'name' => $story['name'],\n                    'tasks' => $story['tasks'],\n                ])->values()->toArray(),\n            ])->values()->toArray(),\n        ])->values()->toArray();\n    }\n\n    public function updateStatus(Request $request, int $id)\n    {\n        $request->validate(['status' => 'required|in:backlog,in_progress,review,done']);\n        $task = TaskEntry::where('user_id', $request->user()->id)->findOrFail($id);\n        $task->update(['status' => $request->status]);\n        return back();\n    }\n}\n```\n\n2. Create `src/platform/resources/js/Pages/Dashboard/Tasks.tsx`:\n```tsx\nimport { useState } from 'react';\nimport { router } from '@inertiajs/react';\nimport DashboardLayout from '@/Layouts/DashboardLayout';\nimport MarkdownRenderer from '@/Components/MarkdownRenderer';\n\n// Full task hierarchy component with:\n// - Collapsible Project > Epic > Story > Task tree\n// - Status filter tabs (All, Backlog, In Progress, Review, Done) with counts\n// - Priority filter dropdown\n// - Project filter dropdown\n// - Search input\n// - Task cards showing key, title, status badge, priority badge\n// - Click task to expand and show markdown description\n// - Status change dropdown on each task\n// - Sort by updated_at, priority\n\n// Status colors mapping\nconst statusColors = {\n    backlog: 'bg-gray-100 text-gray-700',\n    in_progress: 'bg-blue-100 text-blue-700',\n    review: 'bg-yellow-100 text-yellow-700',\n    done: 'bg-green-100 text-green-700',\n};\n\nconst priorityColors = {\n    low: 'text-gray-400',\n    medium: 'text-yellow-500',\n    high: 'text-red-500',\n};\n\n// ... full implementation with tree view, filters, task detail expansion\n```\n\n3. Add routes:\n```php\nRoute::get('/dashboard/tasks', [TasksController::class, 'index'])->name('dashboard.tasks');\nRoute::patch('/dashboard/tasks/{id}/status', [TasksController::class, 'updateStatus'])->name('dashboard.tasks.status');\n```\n\n**File paths:**\n- `src/platform/app/Http/Controllers/Dashboard/TasksController.php`\n- `src/platform/resources/js/Pages/Dashboard/Tasks.tsx`\n- `src/platform/routes/web.php` (updated)"
acceptance_criteria[11]: Tasks page renders at /dashboard/tasks,"Hierarchical tree: Project > Epic > Story > Task",Collapsible tree nodes,"Status filter tabs with counts (All, Backlog, In Progress, Review, Done)",Priority filter dropdown,Project filter dropdown populated from user's projects,"Search across task title, project name, task key","Task cards show key, title, status badge (color-coded), priority",Click task expands to show markdown description,Status changeable via dropdown on each task,"PATCH /dashboard/tasks/{id}/status updates task status"
story: OCD-25
epic: OCD-5
project: oap-cloud
projectKey: OCD
path: .projects/oap-cloud/OCD-5/OCD-25/OCD-72.toon
