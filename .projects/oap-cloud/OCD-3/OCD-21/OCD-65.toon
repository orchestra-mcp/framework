id: OCD-65
type: task
parent: OCD-21
title: "Build Marketplace frontend (catalog, detail, search, deep link install)"
status: backlog
created: 2026-02-09
assignee: null
estimate_minutes: 35
estimate_tokens: null
description: "Create the web marketplace pages with extension catalog, search/filter, detail pages, and deep link install button.\n\n**Steps:**\n\n1. Create controller: `cd src/platform && php artisan make:controller MarketplaceController`\nEdit `src/platform/app/Http/Controllers/MarketplaceController.php`:\n```php\n<?php\nnamespace App\\Http\\Controllers;\n\nuse App\\Models\\Extension;\nuse App\\Models\\ExtensionCategory;\nuse Illuminate\\Http\\Request;\nuse Inertia\\Inertia;\n\nclass MarketplaceController extends Controller\n{\n    public function index(Request $request)\n    {\n        $query = Extension::approved()->with(['category:id,name,slug', 'publisher:id,name']);\n\n        if ($request->filled('category')) {\n            $query->whereHas('category', fn ($q) => $q->where('slug', $request->category));\n        }\n        if ($request->filled('search')) {\n            $search = $request->search;\n            $query->where(fn ($q) => $q->where('name', 'like', \"%{$search}%\")->orWhere('description', 'like', \"%{$search}%\"));\n        }\n        if ($request->sort === 'popular') { $query->orderByDesc('install_count'); }\n        elseif ($request->sort === 'rating') { $query->orderByDesc('average_rating'); }\n        elseif ($request->sort === 'newest') { $query->orderByDesc('created_at'); }\n        else { $query->orderByDesc('install_count'); }\n\n        return Inertia::render('Marketplace/Index', [\n            'extensions' => $query->paginate(24)->through(fn ($ext) => [\n                'id' => $ext->id, 'name' => $ext->name, 'slug' => $ext->slug,\n                'description' => $ext->description, 'icon_url' => $ext->icon_url,\n                'is_free' => $ext->is_free, 'price' => $ext->price,\n                'install_count' => $ext->install_count,\n                'average_rating' => $ext->average_rating,\n                'review_count' => $ext->review_count,\n                'category' => $ext->category?->name,\n                'publisher' => $ext->publisher->name,\n                'is_featured' => $ext->status === 'featured',\n            ]),\n            'categories' => ExtensionCategory::orderBy('sort_order')->get(['id', 'name', 'slug', 'icon']),\n            'filters' => $request->only(['category', 'search', 'sort']),\n        ]);\n    }\n\n    public function show(string $slug)\n    {\n        $ext = Extension::approved()->where('slug', $slug)\n            ->with(['category', 'publisher:id,name', 'reviews.user:id,name'])\n            ->firstOrFail();\n\n        return Inertia::render('Marketplace/Show', [\n            'extension' => [\n                'id' => $ext->id, 'name' => $ext->name, 'slug' => $ext->slug,\n                'description' => $ext->description, 'readme' => $ext->readme,\n                'version' => $ext->version, 'icon_url' => $ext->icon_url,\n                'screenshots' => $ext->screenshots, 'changelog' => $ext->changelog,\n                'is_free' => $ext->is_free, 'price' => $ext->price,\n                'install_count' => $ext->install_count,\n                'average_rating' => $ext->average_rating,\n                'review_count' => $ext->review_count,\n                'category' => $ext->category,\n                'publisher' => $ext->publisher->name,\n                'deep_link_url' => $ext->getDeepLinkUrl(),\n                'reviews' => $ext->reviews->map(fn ($r) => [\n                    'id' => $r->id, 'rating' => $r->rating, 'comment' => $r->comment,\n                    'user' => $r->user->name, 'created_at' => $r->created_at->diffForHumans(),\n                ]),\n            ],\n        ]);\n    }\n}\n```\n\n2. Create `src/platform/resources/js/Pages/Marketplace/Index.tsx`:\n```tsx\nimport { Link, router } from '@inertiajs/react';\nimport GuestLayout from '@/Layouts/GuestLayout';\nimport { useState } from 'react';\n\ninterface Extension {\n    id: number; name: string; slug: string; description: string; icon_url: string | null;\n    is_free: boolean; price: string | null; install_count: number;\n    average_rating: number; review_count: number; category: string | null;\n    publisher: string; is_featured: boolean;\n}\n\ninterface Props {\n    extensions: { data: Extension[]; links: any[] };\n    categories: Array<{ id: number; name: string; slug: string; icon: string | null }>;\n    filters: { category?: string; search?: string; sort?: string };\n}\n\nfunction StarRating({ rating }: { rating: number }) {\n    return <span className=\"text-yellow-400\">{'â˜…'.repeat(Math.round(rating))}{'â˜†'.repeat(5 - Math.round(rating))}</span>;\n}\n\nexport default function MarketplaceIndex({ extensions, categories, filters }: Props) {\n    const [search, setSearch] = useState(filters.search ?? '');\n\n    const handleSearch = (e: React.FormEvent) => {\n        e.preventDefault();\n        router.get('/marketplace', { ...filters, search }, { preserveState: true });\n    };\n\n    return (\n        <GuestLayout title=\"Marketplace\">\n            <div className=\"py-16\">\n                <div className=\"mx-auto max-w-7xl px-4\">\n                    <h1 className=\"text-4xl font-bold text-gray-900\">Extension Marketplace</h1>\n                    <p className=\"mt-2 text-gray-600\">Discover extensions to supercharge your development workflow.</p>\n\n                    {/* Search */}\n                    <form onSubmit={handleSearch} className=\"mt-8 flex gap-2 max-w-xl\">\n                        <input type=\"text\" value={search} onChange={e => setSearch(e.target.value)}\n                            placeholder=\"Search extensions...\" className=\"flex-1 rounded-md border border-gray-300 px-4 py-2\" />\n                        <button type=\"submit\" className=\"rounded-md bg-indigo-600 px-4 py-2 text-white\">Search</button>\n                    </form>\n\n                    <div className=\"mt-8 flex gap-8\">\n                        {/* Category Sidebar */}\n                        <aside className=\"w-48 shrink-0 hidden lg:block\">\n                            <h3 className=\"text-sm font-semibold text-gray-900 mb-3\">Categories</h3>\n                            <nav className=\"space-y-1\">\n                                <Link href=\"/marketplace\" className={`block px-3 py-1.5 rounded text-sm ${!filters.category ? 'bg-indigo-50 text-indigo-700' : 'text-gray-600 hover:bg-gray-50'}`}>All</Link>\n                                {categories.map(cat => (\n                                    <Link key={cat.id} href={`/marketplace?category=${cat.slug}`}\n                                        className={`block px-3 py-1.5 rounded text-sm ${filters.category === cat.slug ? 'bg-indigo-50 text-indigo-700' : 'text-gray-600 hover:bg-gray-50'}`}>\n                                        {cat.name}\n                                    </Link>\n                                ))}\n                            </nav>\n\n                            {/* Sort */}\n                            <h3 className=\"text-sm font-semibold text-gray-900 mb-3 mt-6\">Sort By</h3>\n                            <nav className=\"space-y-1\">\n                                {['popular', 'rating', 'newest'].map(sort => (\n                                    <Link key={sort} href={`/marketplace?${new URLSearchParams({ ...filters, sort }).toString()}`}\n                                        className={`block px-3 py-1.5 rounded text-sm capitalize ${filters.sort === sort ? 'bg-indigo-50 text-indigo-700' : 'text-gray-600 hover:bg-gray-50'}`}>\n                                        {sort}\n                                    </Link>\n                                ))}\n                            </nav>\n                        </aside>\n\n                        {/* Extension Grid */}\n                        <div className=\"flex-1 grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4\">\n                            {extensions.data.map(ext => (\n                                <Link key={ext.id} href={`/marketplace/${ext.slug}`}\n                                    className=\"rounded-xl border border-gray-200 p-4 hover:shadow-md transition-shadow\">\n                                    <div className=\"flex items-start gap-3\">\n                                        <div className=\"h-12 w-12 rounded-lg bg-gray-100 flex items-center justify-center shrink-0 overflow-hidden\">\n                                            {ext.icon_url ? <img src={ext.icon_url} alt=\"\" className=\"h-full w-full object-cover\" /> : <span className=\"text-lg\">ðŸ§©</span>}\n                                        </div>\n                                        <div className=\"min-w-0\">\n                                            <div className=\"flex items-center gap-2\">\n                                                <h3 className=\"text-sm font-semibold text-gray-900 truncate\">{ext.name}</h3>\n                                                {ext.is_featured && <span className=\"rounded bg-yellow-100 px-1.5 py-0.5 text-xs text-yellow-700\">Featured</span>}\n                                            </div>\n                                            <p className=\"text-xs text-gray-500\">{ext.publisher}</p>\n                                        </div>\n                                    </div>\n                                    <p className=\"mt-2 text-sm text-gray-600 line-clamp-2\">{ext.description}</p>\n                                    <div className=\"mt-3 flex items-center justify-between text-xs text-gray-400\">\n                                        <div className=\"flex items-center gap-2\">\n                                            <StarRating rating={ext.average_rating} />\n                                            <span>({ext.review_count})</span>\n                                        </div>\n                                        <div className=\"flex items-center gap-2\">\n                                            <span>{ext.install_count.toLocaleString()} installs</span>\n                                            <span className={ext.is_free ? 'text-green-600 font-medium' : 'text-orange-600 font-medium'}>\n                                                {ext.is_free ? 'Free' : `$${ext.price}`}\n                                            </span>\n                                        </div>\n                                    </div>\n                                </Link>\n                            ))}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </GuestLayout>\n    );\n}\n```\n\n3. Create `src/platform/resources/js/Pages/Marketplace/Show.tsx`:\n```tsx\nimport { Head, Link } from '@inertiajs/react';\nimport GuestLayout from '@/Layouts/GuestLayout';\nimport MarkdownRenderer from '@/Components/MarkdownRenderer';\n\n// ... full extension detail page with:\n// - Extension header (icon, name, publisher, rating, install count, free/paid badge)\n// - Install button that opens deep link: <a href={extension.deep_link_url}>Install in Orchestra</a>\n// - Tabs: README, Changelog, Reviews\n// - README tab: MarkdownRenderer for readme field\n// - Changelog tab: MarkdownRenderer for changelog field\n// - Reviews tab: list of reviews with rating stars, comment, user, date\n// - Screenshot gallery\n```\n\n4. Add routes:\n```php\nRoute::get('/marketplace', [MarketplaceController::class, 'index'])->name('marketplace.index');\nRoute::get('/marketplace/{slug}', [MarketplaceController::class, 'show'])->name('marketplace.show');\n```\n\n**File paths:**\n- `src/platform/app/Http/Controllers/MarketplaceController.php`\n- `src/platform/resources/js/Pages/Marketplace/Index.tsx`\n- `src/platform/resources/js/Pages/Marketplace/Show.tsx`\n- `src/platform/routes/web.php` (updated)"
acceptance_criteria[11]: Marketplace/Index.tsx renders extension grid with search input,Category sidebar filters extensions by category,"Sort options: popular, rating, newest","Extension cards show icon, name, publisher, description, rating stars, install count, free/paid badge",Featured extensions have badge,Marketplace/Show.tsx renders full extension detail,"Install button triggers deep link orchestra://install/{slug}",README and changelog rendered with MarkdownRenderer,"Reviews listed with star rating, comment, user, date",Screenshot gallery displays extension screenshots,Pagination works on extension list
story: OCD-21
epic: OCD-3
project: oap-cloud
projectKey: OCD
path: .projects/oap-cloud/OCD-3/OCD-21/OCD-65.toon
