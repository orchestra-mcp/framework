id: OCD-71
type: task
parent: OCD-24
title: Build Dashboard overview page with progress widgets and charts
status: backlog
created: 2026-02-09
assignee: null
estimate_minutes: 30
estimate_tokens: null
description: "Create the main dashboard page with stat widgets and charts.\n\n**Steps:**\n\n1. Create controller: `cd src/platform && php artisan make:controller Dashboard/DashboardController`\nEdit `src/platform/app/Http/Controllers/Dashboard/DashboardController.php`:\n```php\n<?php\nnamespace App\\Http\\Controllers\\Dashboard;\n\nuse App\\Http\\Controllers\\Controller;\nuse App\\Models\\CommitEntry;\nuse App\\Models\\TaskEntry;\nuse App\\Models\\TimeEntry;\nuse Illuminate\\Http\\Request;\nuse Inertia\\Inertia;\n\nclass DashboardController extends Controller\n{\n    public function index(Request $request)\n    {\n        $user = $request->user();\n        $teamId = $user->currentTeam?->id;\n\n        return Inertia::render('Dashboard/Index', [\n            'stats' => [\n                'tasks_completed_this_week' => TaskEntry::forUser($user->id)->completedThisWeek()->count(),\n                'time_tracked_this_week' => TimeEntry::where('user_id', $user->id)->thisWeek()->timers()->sum('duration_seconds'),\n                'commits_this_week' => CommitEntry::where('user_id', $user->id)->thisWeek()->count(),\n                'current_streak' => $this->calculateStreak($user->id),\n            ],\n            'weeklyProgress' => $this->getWeeklyProgress($user->id),\n            'taskBurndown' => $this->getTaskBurndown($user->id, $teamId),\n        ]);\n    }\n\n    private function calculateStreak(int $userId): int\n    {\n        $streak = 0;\n        $date = now()->startOfDay();\n        while (true) {\n            $hasActivity = TaskEntry::where('user_id', $userId)\n                ->whereDate('updated_at', $date)->exists()\n                || CommitEntry::where('user_id', $userId)\n                ->whereDate('committed_at', $date)->exists();\n            if (!$hasActivity) break;\n            $streak++;\n            $date = $date->subDay();\n        }\n        return $streak;\n    }\n\n    private function getWeeklyProgress(int $userId): array\n    {\n        $data = [];\n        for ($i = 6; $i >= 0; $i--) {\n            $date = now()->subDays($i);\n            $data[] = [\n                'date' => $date->format('D'),\n                'tasks' => TaskEntry::where('user_id', $userId)->where('status', 'done')->whereDate('updated_at', $date)->count(),\n                'hours' => round(TimeEntry::where('user_id', $userId)->timers()->whereDate('started_at', $date)->sum('duration_seconds') / 3600, 1),\n                'commits' => CommitEntry::where('user_id', $userId)->whereDate('committed_at', $date)->count(),\n            ];\n        }\n        return $data;\n    }\n\n    private function getTaskBurndown(int $userId, ?int $teamId): array\n    {\n        // Simplified burndown: tasks remaining per day for past 14 days\n        $data = [];\n        for ($i = 13; $i >= 0; $i--) {\n            $date = now()->subDays($i);\n            $remaining = TaskEntry::where('user_id', $userId)\n                ->whereIn('status', ['backlog', 'in_progress', 'review'])\n                ->whereDate('created_at', '<=', $date)\n                ->count();\n            $data[] = ['date' => $date->format('M d'), 'remaining' => $remaining];\n        }\n        return $data;\n    }\n}\n```\n\n2. Install chart library: `npm install recharts`\n\n3. Create `src/platform/resources/js/Pages/Dashboard/Index.tsx`:\n```tsx\nimport DashboardLayout from '@/Layouts/DashboardLayout';\nimport { BarChart, Bar, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';\n\ninterface Props {\n    stats: {\n        tasks_completed_this_week: number;\n        time_tracked_this_week: number;\n        commits_this_week: number;\n        current_streak: number;\n    };\n    weeklyProgress: Array<{ date: string; tasks: number; hours: number; commits: number }>;\n    taskBurndown: Array<{ date: string; remaining: number }>;\n}\n\nfunction StatCard({ label, value, suffix }: { label: string; value: number | string; suffix?: string }) {\n    return (\n        <div className=\"rounded-xl border border-gray-200 bg-white p-6\">\n            <p className=\"text-sm text-gray-500\">{label}</p>\n            <p className=\"mt-2 text-3xl font-bold text-gray-900\">\n                {value}{suffix && <span className=\"text-lg font-normal text-gray-400 ml-1\">{suffix}</span>}\n            </p>\n        </div>\n    );\n}\n\nfunction formatDuration(seconds: number): string {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    return hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;\n}\n\nexport default function DashboardIndex({ stats, weeklyProgress, taskBurndown }: Props) {\n    return (\n        <DashboardLayout title=\"Overview\">\n            {/* Stat Cards */}\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8\">\n                <StatCard label=\"Tasks Completed This Week\" value={stats.tasks_completed_this_week} />\n                <StatCard label=\"Time Tracked This Week\" value={formatDuration(stats.time_tracked_this_week)} />\n                <StatCard label=\"Commits This Week\" value={stats.commits_this_week} />\n                <StatCard label=\"Current Streak\" value={stats.current_streak} suffix=\"days\" />\n            </div>\n\n            {/* Charts */}\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                {/* Weekly Progress */}\n                <div className=\"rounded-xl border border-gray-200 bg-white p-6\">\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Weekly Progress</h3>\n                    <ResponsiveContainer width=\"100%\" height={250}>\n                        <BarChart data={weeklyProgress}>\n                            <CartesianGrid strokeDasharray=\"3 3\" />\n                            <XAxis dataKey=\"date\" />\n                            <YAxis />\n                            <Tooltip />\n                            <Bar dataKey=\"tasks\" fill=\"#6366f1\" name=\"Tasks\" />\n                            <Bar dataKey=\"commits\" fill=\"#8b5cf6\" name=\"Commits\" />\n                        </BarChart>\n                    </ResponsiveContainer>\n                </div>\n\n                {/* Task Burndown */}\n                <div className=\"rounded-xl border border-gray-200 bg-white p-6\">\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Task Burndown</h3>\n                    <ResponsiveContainer width=\"100%\" height={250}>\n                        <LineChart data={taskBurndown}>\n                            <CartesianGrid strokeDasharray=\"3 3\" />\n                            <XAxis dataKey=\"date\" />\n                            <YAxis />\n                            <Tooltip />\n                            <Line type=\"monotone\" dataKey=\"remaining\" stroke=\"#6366f1\" strokeWidth={2} />\n                        </LineChart>\n                    </ResponsiveContainer>\n                </div>\n            </div>\n        </DashboardLayout>\n    );\n}\n```\n\n4. Update route in `src/platform/routes/web.php`:\n```php\nRoute::get('/dashboard', [DashboardController::class, 'index'])->name('dashboard');\n```\n\n**File paths:**\n- `src/platform/app/Http/Controllers/Dashboard/DashboardController.php`\n- `src/platform/resources/js/Pages/Dashboard/Index.tsx`\n- `src/platform/routes/web.php` (updated)"
acceptance_criteria[9]: Dashboard/Index.tsx renders at /dashboard route,"4 stat cards: tasks completed, time tracked, commits, streak",Time tracked formatted as hours/minutes,Weekly Progress bar chart showing tasks and commits per day,Task Burndown line chart showing remaining tasks over 14 days,Recharts library used for charts,DashboardLayout used with sidebar navigation,Data fetched from DashboardController with proper queries,Streak calculation counts consecutive days with activity
story: OCD-24
epic: OCD-5
project: oap-cloud
projectKey: OCD
path: .projects/oap-cloud/OCD-5/OCD-24/OCD-71.toon
