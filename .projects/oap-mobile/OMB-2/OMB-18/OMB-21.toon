id: OMB-21
type: task
parent: OMB-18
title: Build Auth stack navigator and auth API service
status: done
created: 2026-02-09
assignee: Claude
estimate_minutes: 35
estimate_tokens: null
actual_minutes: 15
actual_tokens: 3000
completed: 2026-02-10
description: "Create the Auth stack navigator connecting all authentication screens and the auth API service layer.\n\n1. Create `src/mobile/src/navigation/AuthNavigator.tsx`:\n   ```typescript\n   import React from 'react';\n   import { createNativeStackNavigator } from '@react-navigation/native-stack';\n   import type { AuthStackParamList } from './types';\n   import { LoginScreen } from '@/app/auth/LoginScreen';\n   import { RegisterScreen } from '@/app/auth/RegisterScreen';\n   import { ResetPasswordScreen } from '@/app/auth/ResetPasswordScreen';\n   import { OTPVerificationScreen } from '@/app/auth/OTPVerificationScreen';\n\n   const Stack = createNativeStackNavigator<AuthStackParamList>();\n\n   export const AuthNavigator: React.FC = () => {\n     return (\n       <Stack.Navigator\n         screenOptions={{\n           headerShown: false,\n           animation: 'slide_from_right',\n           contentStyle: { backgroundColor: '#ffffff' },\n         }}\n       >\n         <Stack.Screen name=\"Login\" component={LoginScreen} />\n         <Stack.Screen name=\"Register\" component={RegisterScreen} />\n         <Stack.Screen name=\"ResetPassword\" component={ResetPasswordScreen} />\n         <Stack.Screen name=\"OTPVerification\" component={OTPVerificationScreen} />\n       </Stack.Navigator>\n     );\n   };\n   ```\n\n2. Create `src/mobile/src/services/authService.ts`:\n   ```typescript\n   import { apiClient } from './apiClient';\n\n   export interface LoginRequest {\n     email: string;\n     password: string;\n     device_name: string;\n   }\n\n   export interface RegisterRequest {\n     name: string;\n     email: string;\n     password: string;\n     password_confirmation: string;\n     device_name: string;\n   }\n\n   export interface AuthResponse {\n     token: string;\n     user: {\n       id: number;\n       name: string;\n       email: string;\n       avatar_url: string | null;\n       role: 'employee' | 'team_owner' | 'admin';\n       team_id: number | null;\n     };\n     requires_2fa?: boolean;\n   }\n\n   export const authService = {\n     async login(data: LoginRequest): Promise<AuthResponse> {\n       const response = await apiClient.post<AuthResponse>('/login', data);\n       return response.data;\n     },\n\n     async register(data: RegisterRequest): Promise<AuthResponse> {\n       const response = await apiClient.post<AuthResponse>('/register', data);\n       return response.data;\n     },\n\n     async forgotPassword(email: string): Promise<{ message: string }> {\n       const response = await apiClient.post<{ message: string }>('/forgot-password', { email });\n       return response.data;\n     },\n\n     async verifyOtp(email: string, code: string): Promise<AuthResponse> {\n       const response = await apiClient.post<AuthResponse>('/verify-otp', { email, code });\n       return response.data;\n     },\n\n     async resendOtp(email: string): Promise<{ message: string }> {\n       const response = await apiClient.post<{ message: string }>('/resend-otp', { email });\n       return response.data;\n     },\n\n     async magicLogin(token: string): Promise<AuthResponse> {\n       const response = await apiClient.post<AuthResponse>('/magic-login', { token });\n       return response.data;\n     },\n\n     async refreshToken(): Promise<{ token: string }> {\n       const response = await apiClient.post<{ token: string }>('/refresh-token');\n       return response.data;\n     },\n\n     async logout(): Promise<void> {\n       await apiClient.post('/logout');\n     },\n\n     async getUser(): Promise<AuthResponse['user']> {\n       const response = await apiClient.get<{ user: AuthResponse['user'] }>('/user');\n       return response.data.user;\n     },\n   };\n   ```\n\n3. Update `src/mobile/src/navigation/RootNavigator.tsx` to import and use `AuthNavigator` instead of the placeholder:\n   ```typescript\n   import { AuthNavigator } from './AuthNavigator';\n   import { useAuthStore } from '@stores';\n\n   // Replace AuthPlaceholder with AuthNavigator\n   // Use useAuthStore().isAuthenticated for the conditional\n   ```\n\n4. Export from `src/mobile/src/services/index.ts`:\n   ```typescript\n   export { authService } from './authService';\n   export type { LoginRequest, RegisterRequest, AuthResponse } from './authService';\n   ```\n\n5. Verify: `npx tsc --noEmit` passes (screens can be empty placeholder components for now)."
acceptance_criteria[5]: AuthNavigator.tsx exists at src/mobile/src/navigation/AuthNavigator.tsx with all auth screens registered,"authService.ts exists with typed methods for: login, register, forgotPassword, verifyOtp, resendOtp, magicLogin, refreshToken, logout, getUser","All API endpoints match Laravel Sanctum conventions (POST /api/login, etc.)",RootNavigator uses AuthNavigator and checks useAuthStore for auth state,TypeScript compiles without errors
story: OMB-18
epic: OMB-2
project: oap-mobile
projectKey: OMB
path: .projects/oap-mobile/OMB-2/OMB-18/OMB-21.toon
