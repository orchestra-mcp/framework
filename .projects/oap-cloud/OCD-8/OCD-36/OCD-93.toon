id: OCD-93
type: task
parent: OCD-36
title: Build Sanctum API controllers and resource classes
status: backlog
created: 2026-02-09
assignee: null
estimate_minutes: 35
estimate_tokens: null
description: "Create RESTful API controllers and JSON resource classes for all models, consumed by mobile app, desktop IDE, and Chrome extension.\n\n**Steps:**\n\n1. Create API resource classes:\n```bash\ncd src/platform\nphp artisan make:resource UserResource\nphp artisan make:resource TaskEntryResource\nphp artisan make:resource TimeEntryResource\nphp artisan make:resource CommitEntryResource\nphp artisan make:resource TeamResource\nphp artisan make:resource ExtensionResource\nphp artisan make:resource NotificationResource\n```\n\n2. Edit `src/platform/app/Http/Resources/TaskEntryResource.php`:\n```php\n<?php\nnamespace App\\Http\\Resources;\n\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Http\\Resources\\Json\\JsonResource;\n\nclass TaskEntryResource extends JsonResource\n{\n    public function toArray(Request $request): array\n    {\n        return [\n            'id' => $this->id,\n            'project_name' => $this->project_name,\n            'epic_name' => $this->epic_name,\n            'story_name' => $this->story_name,\n            'task_title' => $this->task_title,\n            'task_key' => $this->task_key,\n            'description' => $this->description,\n            'status' => $this->status,\n            'priority' => $this->priority,\n            'external_id' => $this->external_id,\n            'external_source' => $this->external_source,\n            'created_at' => $this->created_at->toISOString(),\n            'updated_at' => $this->updated_at->toISOString(),\n        ];\n    }\n}\n```\n\n(Similar pattern for all other resources)\n\n3. Create API controllers:\n```bash\nphp artisan make:controller Api/V1/TaskController\nphp artisan make:controller Api/V1/TimeEntryController\nphp artisan make:controller Api/V1/CommitController\nphp artisan make:controller Api/V1/TeamController\nphp artisan make:controller Api/V1/NotificationController\nphp artisan make:controller Api/V1/AgentController\nphp artisan make:controller Api/V1/ExtensionController\n```\n\n4. Edit `src/platform/app/Http/Controllers/Api/V1/TaskController.php`:\n```php\n<?php\nnamespace App\\Http\\Controllers\\Api\\V1;\n\nuse App\\Http\\Controllers\\Controller;\nuse App\\Http\\Resources\\TaskEntryResource;\nuse App\\Models\\TaskEntry;\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Http\\Resources\\Json\\AnonymousResourceCollection;\n\nclass TaskController extends Controller\n{\n    public function index(Request $request): AnonymousResourceCollection\n    {\n        $query = TaskEntry::forUser($request->user()->id);\n\n        if ($request->filled('status')) $query->where('status', $request->status);\n        if ($request->filled('project')) $query->where('project_name', $request->project);\n        if ($request->filled('search')) {\n            $query->where('task_title', 'like', \"%{$request->search}%\");\n        }\n\n        return TaskEntryResource::collection($query->orderByDesc('updated_at')->paginate($request->per_page ?? 25));\n    }\n\n    public function show(Request $request, int $id): TaskEntryResource\n    {\n        $task = TaskEntry::where('user_id', $request->user()->id)->findOrFail($id);\n        return new TaskEntryResource($task);\n    }\n\n    public function store(Request $request): TaskEntryResource\n    {\n        $validated = $request->validate([\n            'project_name' => 'required|string|max:255',\n            'task_title' => 'required|string|max:255',\n            'epic_name' => 'nullable|string|max:255',\n            'story_name' => 'nullable|string|max:255',\n            'task_key' => 'nullable|string|max:50',\n            'description' => 'nullable|string',\n            'status' => 'in:backlog,in_progress,review,done',\n            'priority' => 'in:low,medium,high',\n        ]);\n\n        $task = TaskEntry::create([\n            ...$validated,\n            'user_id' => $request->user()->id,\n            'team_id' => $request->user()->currentTeam->id,\n        ]);\n\n        return new TaskEntryResource($task);\n    }\n\n    public function update(Request $request, int $id): TaskEntryResource\n    {\n        $task = TaskEntry::where('user_id', $request->user()->id)->findOrFail($id);\n        $validated = $request->validate([\n            'task_title' => 'string|max:255',\n            'description' => 'nullable|string',\n            'status' => 'in:backlog,in_progress,review,done',\n            'priority' => 'in:low,medium,high',\n        ]);\n        $task->update($validated);\n        return new TaskEntryResource($task);\n    }\n\n    public function destroy(Request $request, int $id)\n    {\n        $task = TaskEntry::where('user_id', $request->user()->id)->findOrFail($id);\n        $task->delete();\n        return response()->json(['message' => 'Task deleted.'], 200);\n    }\n}\n```\n\n5. Similar CRUD controllers for TimeEntry, Commit, Team, Notification, Agent, Extension.\n\n6. Create base API response trait at `src/platform/app/Http/Controllers/Api/ApiResponse.php`:\n```php\n<?php\nnamespace App\\Http\\Controllers\\Api;\n\ntrait ApiResponse\n{\n    protected function success(mixed $data = null, string $message = 'Success', int $code = 200)\n    {\n        return response()->json(['success' => true, 'message' => $message, 'data' => $data], $code);\n    }\n\n    protected function error(string $message = 'Error', int $code = 400, mixed $errors = null)\n    {\n        return response()->json(['success' => false, 'message' => $message, 'errors' => $errors], $code);\n    }\n}\n```\n\n**File paths:**\n- `src/platform/app/Http/Resources/UserResource.php`\n- `src/platform/app/Http/Resources/TaskEntryResource.php`\n- `src/platform/app/Http/Resources/TimeEntryResource.php`\n- `src/platform/app/Http/Resources/CommitEntryResource.php`\n- `src/platform/app/Http/Resources/TeamResource.php`\n- `src/platform/app/Http/Resources/ExtensionResource.php`\n- `src/platform/app/Http/Controllers/Api/V1/TaskController.php`\n- `src/platform/app/Http/Controllers/Api/V1/TimeEntryController.php`\n- `src/platform/app/Http/Controllers/Api/V1/CommitController.php`\n- `src/platform/app/Http/Controllers/Api/V1/TeamController.php`\n- `src/platform/app/Http/Controllers/Api/V1/NotificationController.php`\n- `src/platform/app/Http/Controllers/Api/ApiResponse.php`"
acceptance_criteria[8]: API resource classes created for all major models,Resources return consistent JSON format with ISO timestamps,"TaskController with full CRUD (index, show, store, update, destroy)","Index endpoints support pagination, filtering, search",Store/Update endpoints validate inputs,All API actions scoped to authenticated user,ApiResponse trait provides success() and error() helper methods,Consistent JSON response structure across all endpoints
story: OCD-36
epic: OCD-8
project: oap-cloud
projectKey: OCD
path: .projects/oap-cloud/OCD-8/OCD-36/OCD-93.toon
