id: OSV-127
type: task
parent: OSV-44
title: "Implement streaming support, code actions, and Claude CLI integration"
status: backlog
created: 2026-02-09
assignee: null
estimate_minutes: null
estimate_tokens: null
description: "Add streaming message rendering, code block actions, and preserve Claude CLI integration.\n\n**Source reference:** Read `packages/desktop/src/main/services/claudeCliService.ts` for Claude CLI spawn and streaming.\n\n**Target files to create:**\n- `src/app/AI/providers/ClaudeCliProvider.ts` — ModelProvider using Claude CLI\n- `src/app/AI/CodeActions.ts` — code block action handlers\n\n**ClaudeCliProvider:**\n```typescript\nexport class ClaudeCliProvider implements ModelProvider {\n  id = 'claude-cli';\n  name = 'Claude (CLI)';\n  models = ['claude-sonnet-4-20250514'];\n  \n  async *sendMessage(message: string, options: ChatOptions): AsyncIterable<string> {\n    const proc = spawn('claude', ['--model', options.model || this.models[0], '--print'], {\n      env: { ...process.env }\n    });\n    proc.stdin.write(message);\n    proc.stdin.end();\n    for await (const chunk of proc.stdout) {\n      yield chunk.toString();\n    }\n  }\n}\n```\n\n**CodeActions:**\n```typescript\nexport interface CodeAction {\n  id: string;\n  label: string;\n  handler: (code: string, language: string, context: ChatOptions['context']) => Promise<void>;\n}\n\nexport const builtinCodeActions: CodeAction[] = [\n  { id: 'copy', label: 'Copy', handler: async (code) => clipboard.writeText(code) },\n  { id: 'apply', label: 'Apply to File', handler: async (code, _lang, ctx) => { /* write to ctx.filePath */ } },\n  { id: 'diff', label: 'Show Diff', handler: async (code, _lang, ctx) => { /* show diff view */ } },\n];\n```\n\n**IPC handlers:** `chat:send`, `chat:getSession`, `chat:listSessions`, `chat:createSession`, `chat:deleteSession`"
acceptance_criteria[5]: ClaudeCliProvider implements ModelProvider with streaming,Claude CLI spawned with correct args,"Code actions: copy, apply to file, show diff",IPC handlers for all chat operations,Streaming chunks yielded via AsyncIterable
story: OSV-44
epic: OSV-10
project: oap-services
projectKey: OSV
path: .projects/oap-services/OSV-10/OSV-44/OSV-127.toon
